<!DOCTYPE html>
<html class="dark" lang="vi">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>CCCD API Master Admin Dashboard</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect"/>
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    
    <!-- Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    
    <!-- Tailwind Config -->
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#0d7ff2",
                        "secondary": "#0ea5e9",
                        "background-light": "#f5f7f8",
                        "background-dark": "#0b1219",
                        "surface-dark": "#16202a",
                        "glass-border": "rgba(255, 255, 255, 0.08)",
                        "glass-bg": "rgba(22, 32, 42, 0.6)",
                    },
                    fontFamily: {
                        "display": ["Space Grotesk", "sans-serif"],
                        "mono": ["ui-monospace", "SFMono-Regular", "Menlo", "Monaco", "Consolas", "Liberation Mono", "Courier New", "monospace"],
                    },
                    backgroundImage: {
                        'tech-grid': "radial-gradient(circle at center, rgba(13, 127, 242, 0.08) 0%, transparent 70%), linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px), linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px)",
                    },
                    backgroundSize: {
                        'tech-grid': '100% 100%, 40px 40px, 40px 40px',
                    }
                },
            },
        }
    </script>
    
    <style>
        /* Custom scrollbar for dark theme */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #0b1219;
        }
        ::-webkit-scrollbar-thumb {
            background: #1f2d3d;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #314d68;
        }
        
        .glass-panel {
            background: rgba(22, 32, 42, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.08);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        
        .neon-glow:focus-within {
            box-shadow: 0 0 15px rgba(13, 127, 242, 0.3);
            border-color: #0d7ff2;
        }
        
        /* Hide number input spinners */
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        /* Material Symbols */
        .material-symbols-outlined {
            font-family: 'Material Symbols Outlined';
            font-weight: normal;
            font-style: normal;
            font-size: 24px;
            line-height: 1;
            letter-spacing: normal;
            text-transform: none;
            display: inline-block;
            white-space: nowrap;
            word-wrap: normal;
            direction: ltr;
            -webkit-font-feature-settings: 'liga';
            -webkit-font-smoothing: antialiased;
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
    </style>
</head>
<body class="bg-background-light dark:bg-background-dark font-display antialiased text-slate-900 dark:text-white min-h-screen flex flex-col overflow-x-hidden selection:bg-primary selection:text-white">
    <!-- Background Grid Effect -->
    <div class="fixed inset-0 z-0 pointer-events-none bg-tech-grid opacity-50"></div>
    
    <div class="relative z-10 flex h-full grow flex-col">
        <!-- Main Container -->
        <div class="w-full max-w-[1440px] mx-auto px-4 sm:px-6 lg:px-8 py-6">
            <!-- 1. Top Section -->
            <header class="flex flex-col lg:flex-row gap-6 lg:items-end justify-between mb-8 pb-6 border-b border-glass-border">
                <div class="flex flex-col gap-2">
                    <div class="flex items-center gap-3">
                        <span class="material-symbols-outlined text-primary text-4xl">shield_person</span>
                        <h1 class="text-3xl md:text-4xl font-bold tracking-tight text-white">
                            Admin Dashboard
                        </h1>
                    </div>
                    <p class="text-slate-400 text-sm md:text-base font-light">CCCD API Service ‚Ä¢ Master Control Panel</p>
                </div>
                
                <div class="flex flex-col sm:flex-row gap-4 items-end sm:items-end">
                    <!-- Secret Key Field -->
                    <div class="relative w-full sm:w-80 group">
                        <label class="block text-xs font-medium text-slate-400 mb-1.5 ml-1">Admin Secret Key</label>
                        <div class="flex items-center w-full rounded-lg bg-surface-dark border border-slate-700 focus-within:border-primary focus-within:ring-1 focus-within:ring-primary transition-all neon-glow overflow-hidden h-[42px]">
                            <span class="pl-3 text-slate-500">
                                <span class="material-symbols-outlined text-xl">vpn_key</span>
                            </span>
                            <input id="adminKey" class="w-full bg-transparent border-none text-white placeholder-slate-500 focus:ring-0 text-sm py-2.5 px-3" placeholder="Nh·∫≠p ADMIN_SECRET t·ª´ .env" type="text" autocomplete="off"/>
                            <span id="adminKeyStatus" class="pr-3 text-slate-500 hidden">
                                <span class="material-symbols-outlined text-xl">check_circle</span>
                            </span>
                        </div>
                    </div>
                    
                    <!-- Download Stats Button -->
                    <button onclick="loadStats()" class="h-[42px] px-5 bg-primary hover:bg-blue-600 text-white text-sm font-semibold rounded-lg flex items-center gap-2 transition-all shadow-lg shadow-blue-500/20 active:scale-95 w-full sm:w-auto justify-center mt-6 sm:mt-0">
                        <span class="material-symbols-outlined text-[20px]">download</span>
                        T·∫£i th·ªëng k√™
                    </button>
                </div>
            </header>
            
            <!-- Error Message -->
            <div id="error" class="hidden bg-red-500/20 text-red-400 border border-red-500/30 px-4 py-3 rounded-lg mb-6"></div>
            
            <!-- Loading Indicator -->
            <div id="loading" class="hidden text-center py-10 text-slate-400">
                <span class="material-symbols-outlined text-4xl animate-spin">hourglass_empty</span>
                <p class="mt-2">ƒêang t·∫£i...</p>
            </div>
            
            <!-- 2. Overview Stats & Tier Table -->
            <section id="stats" class="hidden grid grid-cols-1 lg:grid-cols-12 gap-6 mb-8">
                <!-- Stats Cards -->
                <div class="lg:col-span-4 flex flex-col gap-4">
                    <!-- Card 1: Requests Today -->
                    <div class="glass-panel rounded-xl p-6 flex flex-col justify-between h-full relative overflow-hidden group">
                        <div class="absolute right-0 top-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
                            <span class="material-symbols-outlined text-8xl text-white">insights</span>
                        </div>
                        <div>
                            <p class="text-slate-400 text-sm font-medium uppercase tracking-wider mb-1">Requests h√¥m nay</p>
                            <div class="flex items-baseline gap-3">
                                <h3 class="text-4xl font-bold text-white" id="requestsToday">0</h3>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Tier Overview Table -->
                <div class="lg:col-span-8 glass-panel rounded-xl flex flex-col">
                    <div class="px-6 py-4 border-b border-glass-border flex justify-between items-center bg-surface-dark/30 rounded-t-xl">
                        <h3 class="text-white font-semibold flex items-center gap-2">
                            <span class="material-symbols-outlined text-slate-400">table_chart</span> 
                            T·ªïng quan theo Tier
                        </h3>
                    </div>
                    <div class="overflow-x-auto flex-1">
                        <table class="w-full text-left text-sm">
                            <thead class="bg-surface-dark/50 text-slate-400 font-medium uppercase text-xs">
                                <tr>
                                    <th class="px-6 py-3">Tier Name</th>
                                    <th class="px-6 py-3">T·ªïng Keys</th>
                                    <th class="px-6 py-3">Keys ƒëang ho·∫°t ƒë·ªông</th>
                                </tr>
                            </thead>
                            <tbody id="tierTableBody" class="divide-y divide-glass-border">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <!-- 3 & 4. Tools Section: Test API & Create Key -->
            <section class="grid grid-cols-1 xl:grid-cols-2 gap-6 mb-8">
                <!-- 3. Test API Module -->
                <div class="glass-panel rounded-xl flex flex-col h-full overflow-hidden border-t-4 border-t-purple-500">
                    <div class="px-6 py-4 bg-surface-dark/40 border-b border-glass-border flex justify-between items-center">
                        <h3 class="text-white font-bold text-lg flex items-center gap-2">
                            <span class="material-symbols-outlined text-purple-400">science</span>
                            Test API
                        </h3>
                        <span class="px-2 py-0.5 rounded text-[10px] bg-purple-500/20 text-purple-300 border border-purple-500/30">SANDBOX</span>
                    </div>
                    
                    <div class="p-6 flex flex-col lg:flex-row gap-6 h-full">
                        <!-- Inputs -->
                        <div class="flex-1 flex flex-col gap-4">
                            <!-- Security status -->
                            <div class="mb-4 p-4 rounded-lg {% if api_key_required %}bg-emerald-500/10 border border-emerald-500/30{% else %}bg-amber-500/10 border border-amber-500/30{% endif %}">
                                {% if api_key_required %}
                                    <strong class="text-emerald-400 text-sm">üîê API Key ƒëang B·∫¨T</strong>
                                    <p class="text-xs text-slate-400 mt-1">
                                        Server y√™u c·∫ßu API key. Mode: <code class="text-slate-300">{{ api_key_mode }}</code>
                                        {% if api_key_mode == 'simple' %}
                                            <br>Key hi·ªán t·∫°i: <code class="text-slate-300">{{ configured_key }}</code>
                                        {% endif %}
                                    </p>
                                {% else %}
                                    <strong class="text-amber-400 text-sm">üîì API Key ƒëang T·∫ÆT</strong>
                                    <p class="text-xs text-slate-400 mt-1">
                                        Server ch∆∞a y√™u c·∫ßu API key (m·ªçi request ƒë·ªÅu ƒë∆∞·ª£c ch·∫•p nh·∫≠n).
                                    </p>
                                {% endif %}
                            </div>
                            
                            <div>
                                <label class="text-xs text-slate-400 block mb-1.5">CCCD Number</label>
                                <input id="demoCccd" class="w-full bg-surface-dark border border-slate-700 rounded-lg text-white text-sm px-3 py-2.5 focus:border-purple-500 focus:ring-1 focus:ring-purple-500" placeholder="001099002..." type="text" value="079203012345" maxlength="12" pattern="[0-9]{12}" inputmode="numeric"/>
                            </div>
                            
                            <div>
                                <label class="text-xs text-slate-400 block mb-1.5">Province Version (Optional)</label>
                                <select id="demoProvinceVersion" class="w-full bg-surface-dark border border-slate-700 rounded-lg text-white text-sm px-3 py-2.5 focus:border-purple-500 focus:ring-1 focus:ring-purple-500">
                                    <option value="">(m·∫∑c ƒë·ªãnh)</option>
                                    <option value="legacy_63">legacy_63</option>
                                    <option value="current_34">current_34</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="text-xs text-slate-400 block mb-1.5">API Key ƒë·ªÉ test</label>
                                <div class="relative">
                                    <input id="demoApiKey" class="w-full bg-surface-dark border border-slate-700 rounded-lg text-white text-sm px-3 py-2.5 focus:border-purple-500 focus:ring-1 focus:ring-purple-500 pr-9" type="password" placeholder="Nh·∫≠p API Key ƒë·ªÉ test"/>
                                </div>
                            </div>
                            
                            <button onclick="testApi()" class="mt-2 bg-purple-600 hover:bg-purple-500 text-white font-medium py-2.5 rounded-lg transition-colors flex items-center justify-center gap-2">
                                <span class="material-symbols-outlined text-[18px]">send</span> Send Request
                            </button>
                            
                            <div id="demoError" class="hidden bg-red-500/20 text-red-400 border border-red-500/30 px-4 py-3 rounded-lg mt-2"></div>
                        </div>
                        
                        <!-- Console Output -->
                        <div id="demoResult" class="hidden flex-1 bg-[#0d1117] rounded-lg border border-slate-800 p-4 font-mono text-xs overflow-y-auto max-h-[250px] shadow-inner">
                            <div class="flex justify-between items-center mb-2 pb-2 border-b border-slate-800">
                                <span class="text-slate-500">Output Console</span>
                                <span id="demoStatus" class="text-emerald-500">-</span>
                            </div>
                            <pre id="demoOutput" class="text-slate-300 leading-relaxed whitespace-pre-wrap">{}</pre>
                        </div>
                    </div>
                </div>
                
                <!-- 4. Create Key Module -->
                <div class="glass-panel rounded-xl flex flex-col h-full overflow-hidden border-t-4 border-t-primary">
                    <div class="px-6 py-4 bg-surface-dark/40 border-b border-glass-border">
                        <h3 class="text-white font-bold text-lg flex items-center gap-2">
                            <span class="material-symbols-outlined text-primary">vpn_key_alert</span>
                            T·∫°o API Key M·ªõi
                        </h3>
                    </div>
                    
                    <div class="p-6 flex flex-col h-full justify-between">
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-6">
                            <div>
                                <label class="text-xs text-slate-400 block mb-1.5">Select Tier</label>
                                <div class="relative">
                                    <select id="createTier" class="appearance-none w-full bg-surface-dark border border-slate-700 rounded-lg text-white text-sm px-3 py-3 focus:border-primary focus:ring-1 focus:ring-primary cursor-pointer">
                                        <option value="free">Free Tier (10 req/ph√∫t)</option>
                                        <option value="premium">Premium (100 req/ph√∫t)</option>
                                        <option value="ultra" selected>Ultra (1000 req/ph√∫t)</option>
                                    </select>
                                    <span class="absolute right-3 top-3 text-slate-400 pointer-events-none material-symbols-outlined text-lg">expand_more</span>
                                </div>
                            </div>
                            <div>
                                <label class="text-xs text-slate-400 block mb-1.5">Validity (Days)</label>
                                <div class="relative">
                                    <input id="createDays" class="w-full bg-surface-dark border border-slate-700 rounded-lg text-white text-sm px-3 py-3 focus:border-primary focus:ring-1 focus:ring-primary" type="number" placeholder="30" min="1" step="1" pattern="[0-9]+"/>
                                    <span class="absolute right-3 top-3 text-slate-500 text-xs mt-0.5">days</span>
                                </div>
                            </div>
                        </div>
                        
                        <button onclick="createKey()" class="w-full bg-gradient-to-r from-primary to-blue-600 hover:from-blue-500 hover:to-blue-500 text-white font-bold py-3 rounded-lg shadow-lg shadow-blue-500/20 transition-all transform active:scale-[0.98] flex items-center justify-center gap-2 mb-6">
                            <span class="material-symbols-outlined">auto_fix_high</span> Generate Key
                        </button>
                        
                        <div id="createError" class="hidden bg-red-500/20 text-red-400 border border-red-500/30 px-4 py-3 rounded-lg mb-4"></div>
                        
                        <!-- Result Area -->
                        <div id="createSuccess" class="hidden mt-auto bg-[#0b1219] border border-primary/50 rounded-lg p-4 relative group">
                            <div class="absolute -inset-0.5 bg-gradient-to-r from-primary to-cyan-400 rounded-lg blur opacity-20 group-hover:opacity-40 transition duration-1000 group-hover:duration-200"></div>
                            <div class="relative flex flex-col gap-2">
                                <span class="text-xs text-primary font-medium uppercase tracking-wider">‚ö†Ô∏è L∆ØU √ù: Key ch·ªâ hi·ªÉn th·ªã 1 l·∫ßn n√†y. H√£y copy v√† l∆∞u ngay!</span>
                                <div class="flex items-center gap-2 justify-between bg-black/40 rounded px-3 py-2 border border-white/5">
                                    <code id="createdKey" class="text-emerald-400 font-mono text-sm tracking-wide break-all"></code>
                                    <button onclick="navigator.clipboard.writeText(document.getElementById('createdKey').textContent)" class="text-slate-400 hover:text-white transition-colors" title="Copy to clipboard">
                                        <span class="material-symbols-outlined text-lg">content_copy</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- 5. Management Tables (Tabs) -->
            <section class="glass-panel rounded-xl overflow-hidden mb-10">
                <!-- Tabs Header -->
                <div class="flex border-b border-glass-border overflow-x-auto">
                    <button id="paymentsTab" onclick="switchTab('payments')" class="px-6 py-4 text-sm font-medium text-white border-b-2 border-primary bg-primary/5 flex items-center gap-2 whitespace-nowrap">
                        <span class="material-symbols-outlined text-[18px]">payments</span> Pending Payments
                    </button>
                    <button id="usersTab" onclick="switchTab('users')" class="px-6 py-4 text-sm font-medium text-slate-400 hover:text-white hover:bg-white/5 transition-colors border-b-2 border-transparent flex items-center gap-2 whitespace-nowrap">
                        <span class="material-symbols-outlined text-[18px]">group</span> Qu·∫£n L√Ω Users
                    </button>
                    <div class="flex-1 flex items-center justify-end px-4 gap-2">
                        <div class="relative hidden sm:flex items-center gap-2">
                            <div class="relative">
                                <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 material-symbols-outlined text-lg pointer-events-none">search</span>
                                <input id="userSearchInput" class="bg-surface-dark border border-slate-700 rounded-full pl-9 pr-4 py-1.5 text-sm text-white focus:ring-1 focus:ring-primary focus:border-primary w-48 transition-all focus:w-64 h-[36px]" placeholder="Search users..." type="text"/>
                            </div>
                            <button onclick="loadUsersList()" class="h-[36px] w-[36px] flex items-center justify-center text-slate-400 hover:text-white rounded-lg border border-slate-700 hover:bg-slate-800 transition-colors">
                                <span class="material-symbols-outlined text-lg">search</span>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Payments Content -->
                <div id="paymentsContent">
                    <div id="paymentsContainer" class="p-6">
                        <p class="text-center text-slate-400 py-10">
                            Vui l√≤ng nh·∫≠p Admin Secret Key ·ªü tr√™n v√† nh·∫•n "T·∫£i th·ªëng k√™" ƒë·ªÉ xem pending payments
                        </p>
                    </div>
                </div>
                
                <!-- Users Content -->
                <div id="usersContent" class="hidden">
                    <div id="usersContainer" class="p-6">
                        <p class="text-center text-slate-400 py-10">
                            Vui l√≤ng nh·∫≠p Admin Secret Key ·ªü tr√™n v√† nh·∫•n "T·∫£i th·ªëng k√™" ƒë·ªÉ xem danh s√°ch users
                        </p>
                    </div>
                </div>
            </section>
        </div>
    </div>
    
    <!-- External JavaScript -->
    <script src="{{ url_for('static', filename='js/admin.js') }}"></script>
</body>
</html>
