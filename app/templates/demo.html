<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>CCCD API Demo</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 24px; }
      .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: end; }
      label { display: block; font-size: 12px; color: #444; margin-bottom: 6px; }
      input, select { padding: 10px; border: 1px solid #ccc; border-radius: 8px; min-width: 220px; }
      button { padding: 10px 14px; border: 0; border-radius: 8px; background: #111; color: #fff; cursor: pointer; }
      button:disabled { opacity: 0.6; cursor: not-allowed; }
      pre { background: #0b1020; color: #e7e7e7; padding: 14px; border-radius: 10px; overflow: auto; }
      .hint { color: #555; font-size: 13px; margin-top: 10px; }
      .ok { color: #0a7a2f; font-weight: 600; }
      .bad { color: #b00020; font-weight: 600; }
      a { color: #0b57d0; }
    </style>
  </head>
  <body>
    <h2>CCCD API Demo</h2>
    <div class="hint">
      Trang này dùng để test local nhanh cho endpoint <code>POST /v1/cccd/parse</code>.
      Health check: <a href="/health">/health</a>
    </div>

    <div style="margin-top:16px" class="row">
      <div>
        <label>CCCD (12 số)</label>
        <input id="cccd" value="012345678901" />
      </div>
      <div>
        <label>province_version (tuỳ chọn)</label>
        <select id="province_version">
          <option value="">(mặc định)</option>
          <option value="legacy_64">legacy_64</option>
          <option value="current_34">current_34</option>
        </select>
      </div>
      <button id="btn">Parse</button>
    </div>

    <div style="margin-top:16px" class="hint">
      Kỳ vọng:
      <ul>
        <li>Nhập CCCD đúng 12 số → <span class="ok">HTTP 200</span>, <code>success=true</code>, <code>is_valid_format=true</code></li>
        <li>Nhập CCCD sai (ví dụ “123”) → <span class="bad">HTTP 400</span>, <code>success=false</code>, <code>is_valid_format=false</code></li>
      </ul>
    </div>

    <h3>Kết quả</h3>
    <div class="hint">Status: <span id="status">-</span></div>
    <pre id="out">{}</pre>

    <script>
      const btn = document.getElementById("btn");
      const out = document.getElementById("out");
      const statusEl = document.getElementById("status");
      const cccdEl = document.getElementById("cccd");
      const pvEl = document.getElementById("province_version");

      async function run() {
        btn.disabled = true;
        statusEl.textContent = "loading...";
        out.textContent = "";

        const rawCccd = (cccdEl.value || "").trim();
        const payload = {};
        // Allow testing "missing cccd" by leaving the field blank
        if (rawCccd !== "") payload.cccd = rawCccd;
        if (pvEl.value) payload.province_version = pvEl.value;

        try {
          const resp = await fetch("/v1/cccd/parse", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          statusEl.textContent = resp.status;
          const text = await resp.text();
          try {
            out.textContent = JSON.stringify(JSON.parse(text), null, 2);
          } catch {
            out.textContent = text;
          }
        } catch (e) {
          statusEl.textContent = "error";
          out.textContent = String(e);
        } finally {
          btn.disabled = false;
        }
      }

      btn.addEventListener("click", run);
    </script>
  </body>
</html>


