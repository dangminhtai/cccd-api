{% extends "base.html" %}

{% block title %}Upgrade Tier - CCCD API{% endblock %}

{% block extra_css %}
<style>
    .pricing-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: var(--spacing-6); margin-bottom: var(--spacing-5); }
    .pricing-card { border: 2px solid var(--color-border); border-radius: var(--radius-lg); padding: var(--spacing-6); transition: all var(--transition-base); position: relative; }
    .pricing-card:hover { border-color: var(--color-primary); box-shadow: var(--shadow-lg); }
    .pricing-card.current { border-color: var(--color-primary); background: var(--color-bg-secondary); }
    .pricing-card.current::before { content: "Gói hiện tại"; position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: var(--color-primary); color: white; padding: 4px var(--spacing-4); border-radius: var(--radius-full); font-size: var(--font-size-xs); font-weight: var(--font-weight-semibold); }
    .pricing-card h3 { font-size: var(--font-size-2xl); color: var(--color-text-primary); margin-bottom: 10px; }
    .pricing-card .price { font-size: var(--font-size-4xl); font-weight: var(--font-weight-bold); color: var(--color-primary); margin-bottom: 5px; }
    .pricing-card .price-unit { font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-bottom: var(--spacing-5); }
    .pricing-card .features { list-style: none; margin-bottom: var(--spacing-6); padding: 0; }
    .pricing-card .features li { padding: var(--spacing-2) 0; color: var(--color-text-primary); }
    .pricing-card .features li::before { content: "✓ "; color: var(--color-success-text); font-weight: var(--font-weight-semibold); margin-right: var(--spacing-2); }
    .btn-select { width: 100%; padding: var(--spacing-3); background: var(--color-primary); color: white; border: none; border-radius: var(--radius-md); font-size: var(--font-size-base); font-weight: var(--font-weight-semibold); cursor: pointer; transition: background var(--transition-fast); }
    .btn-select:hover { background: var(--color-primary-dark); }
    .btn-select:disabled { background: var(--color-bg-tertiary); cursor: not-allowed; }
    .btn-select.current { background: var(--color-bg-tertiary); }
    .info-box { background: var(--color-info-bg); border-left: 4px solid var(--color-info); padding: var(--spacing-4); border-radius: var(--radius-md); margin-bottom: var(--spacing-6); }
    .info-box p { margin: 0; color: var(--color-info-text); }
</style>
{% endblock %}

{% block content %}
<div class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages">
                {% for category, message in messages %}
                    <div class="flash flash-{{ category }}">{{ message }}</div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}
    
    <div class="section card">
        <div class="card-header">
            <h2>Nâng cấp gói đăng ký</h2>
        </div>
        <div class="card-body">
            <div class="info-box">
                <p><strong>Lưu ý:</strong> Thanh toán hiện tại được xử lý thủ công. Sau khi bạn gửi yêu cầu nâng cấp, admin sẽ xem xét và kích hoạt gói mới cho bạn.</p>
            </div>
            
            <div class="pricing-grid">
                {% for tier_key, tier_info in pricing.items() %}
                <div class="pricing-card {% if tier_key == current_tier %}current{% endif %}">
                    <h3>{{ tier_info.name }}</h3>
                    <div class="price">
                        {% if tier_info.currency == 'VND' %}
                            {{ "{:,.0f}".format(tier_info.price).replace(",", ".") }} {{ tier_info.currency }}
                        {% else %}
                            ${{ "%.2f"|format(tier_info.price) }} {{ tier_info.currency }}
                        {% endif %}
                    </div>
                    <div class="price-unit">/ tháng</div>
                    <ul class="features">
                        {% for feature in tier_info.features %}
                        <li>{{ feature }}</li>
                        {% endfor %}
                    </ul>
                    {% if tier_key == current_tier %}
                        <button class="btn-select current" disabled>Gói hiện tại</button>
                    {% else %}
                        <form method="POST" action="{{ url_for('portal.upgrade') }}" style="margin: 0;">
                            <input type="hidden" name="action" value="request_upgrade">
                            <input type="hidden" name="tier" value="{{ tier_key }}">
                            <button type="submit" class="btn-select">Chọn gói này</button>
                        </form>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
